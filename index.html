<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Racer: 3 Strikes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; background: #111; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        #gameCanvas { background: #222; display: block; margin: 0 auto; border-left: 4px solid #444; border-right: 4px solid #444; }
        .light { width: 20px; height: 20px; border-radius: 50%; margin: 4px; border: 2px solid #000; }
        .stat-card { background: rgba(0,0,0,0.8); border: 1px solid #444; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div class="relative shadow-2xl">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        
        <div class="absolute top-4 left-4 right-4 flex justify-between items-start pointer-events-none">
            <div class="stat-card">
                <p class="text-[10px] text-gray-400 uppercase">Score</p>
                <span id="score" class="text-2xl font-bold text-white">0</span>
            </div>
            
            <div class="flex flex-col gap-2">
                <div class="stat-card text-right">
                    <p class="text-[10px] text-gray-400 uppercase">Strikes</p>
                    <span id="lives" class="text-2xl font-bold text-red-500">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                </div>
                <div class="bg-gray-900 p-1 rounded-lg border border-gray-700 flex flex-col">
                    <div id="redL" class="light bg-red-950"></div>
                    <div id="yellowL" class="light bg-yellow-950"></div>
                    <div id="greenL" class="light bg-green-950"></div>
                </div>
            </div>
        </div>

        <div id="overlay" class="absolute inset-0 bg-black/90 flex flex-col items-center justify-center p-8 text-center">
            <h1 id="statusTitle" class="text-white text-5xl font-black mb-4 italic tracking-tighter">SPEED <span class="text-blue-500">LIMIT</span></h1>
            <p id="statusDesc" class="text-gray-400 mb-8">Stop for Reds. Don't hit pedestrians. 3 mistakes allowed.</p>
            <button onclick="startGame()" class="bg-white text-black px-10 py-4 font-bold rounded-sm hover:bg-blue-500 hover:text-white transition-all">START RACE</button>
        </div>

        <div id="quizBox" class="hidden absolute inset-0 bg-red-900/95 flex flex-col items-center justify-center p-10">
            <h2 class="text-white text-2xl font-bold mb-2">FINAL CHANCE!</h2>
            <p class="text-red-200 mb-6 text-center italic">Answer correctly to keep your score or fail the academy.</p>
            <p id="qText" class="text-white text-xl mb-6 text-center font-bold"></p>
            <div id="qOptions" class="w-full space-y-3"></div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let active = false;
    let score = 0;
    let speed = 0;
    let lives = 3;
    let signal = 'GREEN';
    let player = { x: 175, y: 480, w: 50, h: 85 };
    let hazard = { active: false, y: -200, pedX: -40 };
    let frame = 0;

    const questions = [
        { q: "What does a flashing yellow light mean?", a: ["Stop immediately", "Proceed with caution", "Speed up"], c: 1 },
        { q: "You see a pedestrian near the crossing. You...", a: ["Ignore them", "Slow down and prepare to stop", "Honk loudly"], c: 1 },
        { q: "What distance should you keep from the car ahead?", a: ["1 meter", "3-second gap", "No gap needed"], c: 1 }
    ];

    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    function startGame() {
        document.getElementById('overlay').classList.add('hidden');
        lives = 3; score = 0; speed = 0; signal = 'GREEN';
        updateUI();
        cycleTraffic();
        active = true;
        loop();
    }

    function updateUI() {
        document.getElementById('score').innerText = score;
        document.getElementById('lives').innerText = "‚ù§Ô∏è".repeat(lives);
    }

    function cycleTraffic() {
        if(!active) return;
        const sequence = { 'GREEN': ['YELLOW', 5000], 'YELLOW': ['RED', 2000], 'RED': ['GREEN', 4000] };
        const [next, time] = sequence[signal];
        signal = next;
        
        document.getElementById('redL').style.backgroundColor = signal === 'RED' ? '#ff0000' : '#300';
        document.getElementById('yellowL').style.backgroundColor = signal === 'YELLOW' ? '#ffaa00' : '#330';
        document.getElementById('greenL').style.backgroundColor = signal === 'GREEN' ? '#00ff00' : '#030';
        
        setTimeout(cycleTraffic, time);
    }

    function handleMistake(reason) {
        lives--;
        updateUI();
        speed = 0;
        hazard.active = false;
        hazard.y = -200;

        if (lives <= 0) {
            showQuiz();
        } else {
            // Brief pause before continuing
            active = false;
            alert(reason + " - Careful! " + lives + " lives left.");
            active = true;
            loop();
        }
    }

    function showQuiz() {
        active = false;
        const q = questions[Math.floor(Math.random() * questions.length)];
        document.getElementById('quizBox').classList.remove('hidden');
        document.getElementById('qText').innerText = q.q;
        
        const opts = document.getElementById('qOptions');
        opts.innerHTML = '';
        q.a.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = "w-full bg-white text-black p-4 font-bold hover:bg-gray-200 transition";
            btn.innerText = opt;
            btn.onclick = () => {
                if(i === q.c) {
                    lives = 1; // Give one last life
                    updateUI();
                    document.getElementById('quizBox').classList.add('hidden');
                    active = true;
                    loop();
                } else {
                    gameOver();
                }
            };
            opts.appendChild(btn);
        });
    }

    function gameOver() {
        document.getElementById('quizBox').classList.add('hidden');
        document.getElementById('overlay').classList.remove('hidden');
        document.getElementById('statusTitle').innerText = "LICENSE REVOKED";
        document.getElementById('statusDesc').innerText = "Final Score: " + score;
    }

    function loop() {
        if (!active) return;
        frame++;
        ctx.fillStyle = "#222";
        ctx.fillRect(0, 0, 400, 600);

        // Road Lines
        ctx.strokeStyle = "#444";
        ctx.setLineDash([40, 40]);
        ctx.lineDashOffset = -frame * speed;
        ctx.beginPath();
        ctx.moveTo(200, 0); ctx.lineTo(200, 600);
        ctx.stroke();

        // Controls
        if (keys['ArrowUp']) speed = Math.min(speed + 0.2, 7);
        else speed = Math.max(speed - 0.25, 0);
        if (keys['ArrowLeft'] && player.x > 10) player.x -= 5;
        if (keys['ArrowRight'] && player.x < 340) player.x += 5;

        // Red Light Check
        if (signal === 'RED' && speed > 0.5) {
            handleMistake("üö® RED LIGHT VIOLATION!");
            return;
        }

        // Hazard Spawn
        if (!hazard.active && frame % 300 === 0) {
            hazard.active = true;
            hazard.y = -150;
            hazard.pedX = -30;
        }

        if (hazard.active) {
            hazard.y += speed;
            hazard.pedX += 2.5;
            
            // Draw Zebra
            ctx.fillStyle = "rgba(255,255,255,0.8)";
            for(let i=0; i<8; i++) ctx.fillRect(i*55, hazard.y, 35, 100);
            
            // Draw Man (Walking)
            ctx.fillStyle = "#ffdbac"; ctx.fillRect(hazard.pedX, hazard.y+20, 20, 20); // Head
            ctx.fillStyle = "#33d"; ctx.fillRect(hazard.pedX, hazard.y+40, 20, 35); // Body
            // Animated Legs
            ctx.fillStyle = "#000";
            let legOffset = Math.sin(frame * 0.2) * 10;
            ctx.fillRect(hazard.pedX + 2, hazard.y+75, 6, 15 + legOffset);
            ctx.fillRect(hazard.pedX + 12, hazard.y+75, 6, 15 - legOffset);

            // Crossing Penalty
            if (speed > 0.5 && player.y < hazard.y + 100 && player.y + player.h > hazard.y) {
                handleMistake("üö∂ PEDESTRIAN IN CROSSWALK!");
                return;
            }

            if (hazard.y > 600) {
                hazard.active = false;
                score += 50;
                updateUI();
            }
        }

        // Draw Player Car
        ctx.fillStyle = "#3b82f6";
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.fillStyle = "#000"; // Wheels
        ctx.fillRect(player.x-5, player.y+10, 5, 20);
        ctx.fillRect(player.x+50, player.y+10, 5, 20);
        ctx.fillRect(player.x-5, player.y+60, 5, 20);
        ctx.fillRect(player.x+50, player.y+60, 5, 20);

        requestAnimationFrame(loop);
    }
</script>
</body>
</html>
       
